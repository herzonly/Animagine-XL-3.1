<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Image Generator</title>
  <style>
    :root {
      --primary: #8b5cf6;
      --primary-hover: #7c3aed;
      --primary-light: #f5f3ff;
      --primary-dark: #6d28d9;
      --secondary: #e2e8f0;
      --text: #1e293b;
      --text-light: #64748b;
      --background: #ffffff;
      --error: #ef4444;
      --border: #e2e8f0;
      --border-radius: 0.5rem;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(to bottom right, #f5f3ff, #eff6ff);
      color: var(--text);
      min-height: 100vh;
      padding: 2rem 1rem;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .header h1 {
      color: var(--primary-dark);
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    .header p {
      color: var(--text-light);
      max-width: 600px;
      margin: 0 auto;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 2rem;
    }

    @media (min-width: 1024px) {
      .grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    .card {
      background: var(--background);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .card-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border);
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .card-description {
      color: var(--text-light);
      font-size: 0.875rem;
    }

    .card-content {
      padding: 1.5rem;
    }

    .card-footer {
      padding: 1.5rem;
      border-top: 1px solid var(--border);
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group:last-child {
      margin-bottom: 0;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .form-control {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: var(--border-radius);
      font-size: 1rem;
      transition: border-color 0.15s ease-in-out;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary);
    }

    textarea.form-control {
      min-height: 100px;
      resize: vertical;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem 1rem;
      border: none;
      border-radius: var(--border-radius);
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.15s ease-in-out;
    }

    .btn-primary {
      background-color: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background-color: var(--primary-hover);
    }

    .btn-outline {
      background-color: transparent;
      border: 1px solid var(--border);
      color: var(--text);
    }

    .btn-outline:hover {
      background-color: var(--secondary);
    }

    .btn-block {
      width: 100%;
    }

    .btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    .btn-icon {
      margin-right: 0.5rem;
    }

    .accordion {
      border: 1px solid var(--border);
      border-radius: var(--border-radius);
      margin-bottom: 1.5rem;
    }

    .accordion-header {
      padding: 1rem;
      background-color: var(--background);
      border-bottom: 1px solid var(--border);
      font-weight: 500;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .accordion-content {
      padding: 1rem;
      display: none;
    }

    .accordion-content.active {
      display: block;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .form-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .form-value {
      font-size: 0.875rem;
      color: var(--text-light);
    }

    .slider {
      width: 100%;
      height: 5px;
      border-radius: 5px;
      background: var(--secondary);
      outline: none;
      -webkit-appearance: none;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
    }

    .radio-group {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
    }

    .radio-item {
      display: flex;
      align-items: center;
    }

    .radio-label {
      margin-left: 0.5rem;
      font-size: 0.875rem;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 40px;
      height: 20px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider-switch {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--secondary);
      transition: .4s;
      border-radius: 20px;
    }

    .slider-switch:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 2px;
      bottom: 2px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider-switch {
      background-color: var(--primary);
    }

    input:checked + .slider-switch:before {
      transform: translateX(20px);
    }

    .switch-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .image-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 300px;
    }

    .image-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 300px;
      width: 100%;
      border: 2px dashed var(--border);
      border-radius: var(--border-radius);
    }

    .image-placeholder-icon {
      font-size: 3rem;
      color: var(--text-light);
      margin-bottom: 1rem;
    }

    .image-placeholder-text {
      color: var(--text-light);
      text-align: center;
    }

    .generated-image {
      max-width: 100%;
      max-height: 500px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
    }

    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 300px;
    }

    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border-left-color: var(--primary);
      animation: spin 1s linear infinite;
      margin-bottom: 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .error-message {
      color: var(--error);
      text-align: center;
      margin-bottom: 1rem;
    }

    .select-container {
      position: relative;
    }

    .select {
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.75rem center;
      background-size: 1em;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>AI Image Generator</h1>
      <p>Create stunning AI-generated images with Animagine XL 3.1. Just enter a prompt and watch the magic happen!</p>
    </div>

    <div class="grid">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Image Settings</h2>
          <p class="card-description">Configure your image generation parameters</p>
        </div>
        <div class="card-content">
          <div class="form-group">
            <label for="prompt" class="form-label">Prompt</label>
            <textarea id="prompt" class="form-control" placeholder="Describe what you want to see in the image..."></textarea>
          </div>

          <div class="form-group">
            <label for="negativePrompt" class="form-label">Negative Prompt</label>
            <textarea id="negativePrompt" class="form-control" placeholder="Describe what you don't want to see in the image..."></textarea>
          </div>

          <div class="accordion">
            <div class="accordion-header" id="advancedSettingsHeader">
              Advanced Settings
              <span class="accordion-icon">▼</span>
            </div>
            <div class="accordion-content" id="advancedSettingsContent">
              <div class="form-group">
                <div class="form-header">
                  <label for="seed" class="form-label">Seed</label>
                  <span class="form-value" id="seedValue">0</span>
                </div>
                <input type="number" id="seed" class="form-control" min="0" max="2147483647" value="0">
              </div>

              <div class="form-row">
                <div class="form-group">
                  <div class="form-header">
                    <label for="width" class="form-label">Width</label>
                    <span class="form-value" id="widthValue">512px</span>
                  </div>
                  <input type="number" id="width" class="form-control" min="512" max="2048" step="64" value="512">
                </div>

                <div class="form-group">
                  <div class="form-header">
                    <label for="height" class="form-label">Height</label>
                    <span class="form-value" id="heightValue">512px</span>
                  </div>
                  <input type="number" id="height" class="form-control" min="512" max="2048" step="64" value="512">
                </div>
              </div>

              <div class="form-group">
                <div class="form-header">
                  <label for="guidanceScale" class="form-label">Guidance Scale</label>
                  <span class="form-value" id="guidanceScaleValue">7</span>
                </div>
                <input type="range" id="guidanceScale" class="slider" min="1" max="12" step="0.1" value="7">
              </div>

              <div class="form-group">
                <div class="form-header">
                  <label for="steps" class="form-label">Inference Steps</label>
                  <span class="form-value" id="stepsValue">20</span>
                </div>
                <input type="range" id="steps" class="slider" min="1" max="50" value="20">
              </div>

              <div class="form-group">
                <label for="sampler" class="form-label">Sampler</label>
                <div class="select-container">
                  <select id="sampler" class="form-control select">
                    <option value="DPM++ 2M Karras">DPM++ 2M Karras</option>
                    <option value="Euler a">Euler a</option>
                    <option value="Euler">Euler</option>
                    <option value="LMS">LMS</option>
                    <option value="Heun">Heun</option>
                    <option value="DPM2">DPM2</option>
                    <option value="DPM2 a">DPM2 a</option>
                    <option value="DPM++ 2S a">DPM++ 2S a</option>
                    <option value="DPM++ SDE">DPM++ SDE</option>
                    <option value="DPM fast">DPM fast</option>
                    <option value="DPM adaptive">DPM adaptive</option>
                    <option value="LMS Karras">LMS Karras</option>
                    <option value="DPM2 Karras">DPM2 Karras</option>
                    <option value="DPM2 a Karras">DPM2 a Karras</option>
                    <option value="DPM++ 2S a Karras">DPM++ 2S a Karras</option>
                    <option value="DPM++ SDE Karras">DPM++ SDE Karras</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Aspect Ratio</label>
                <div class="radio-group" id="aspectRatio">
                  <div class="radio-item">
                    <input type="radio" id="ratio-512x512" name="aspectRatio" value="512 x 512">
                    <label for="ratio-512x512" class="radio-label">512 x 512</label>
                  </div>
                  <div class="radio-item">
                    <input type="radio" id="ratio-768x512" name="aspectRatio" value="768 x 512">
                    <label for="ratio-768x512" class="radio-label">768 x 512</label>
                  </div>
                  <div class="radio-item">
                    <input type="radio" id="ratio-512x768" name="aspectRatio" value="512 x 768">
                    <label for="ratio-512x768" class="radio-label">512 x 768</label>
                  </div>
                  <div class="radio-item">
                    <input type="radio" id="ratio-1024x1024" name="aspectRatio" value="1024 x 1024" checked>
                    <label for="ratio-1024x1024" class="radio-label">1024 x 1024</label>
                  </div>
                  <div class="radio-item">
                    <input type="radio" id="ratio-1152x896" name="aspectRatio" value="1152 x 896">
                    <label for="ratio-1152x896" class="radio-label">1152 x 896</label>
                  </div>
                  <div class="radio-item">
                    <input type="radio" id="ratio-896x1152" name="aspectRatio" value="896 x 1152">
                    <label for="ratio-896x1152" class="radio-label">896 x 1152</label>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="stylePreset" class="form-label">Style Preset</label>
                <div class="select-container">
                  <select id="stylePreset" class="form-control select">
                    <option value="(None)">(None)</option>
                    <option value="Cinematic">Cinematic</option>
                    <option value="3D Model">3D Model</option>
                    <option value="Anime">Anime</option>
                    <option value="Digital Art">Digital Art</option>
                    <option value="Photographic">Photographic</option>
                    <option value="Pixel art">Pixel art</option>
                    <option value="Fantasy art">Fantasy art</option>
                    <option value="Neonpunk">Neonpunk</option>
                    <option value="Manga">Manga</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label for="qualityPreset" class="form-label">Quality Tags Preset</label>
                <div class="select-container">
                  <select id="qualityPreset" class="form-control select">
                    <option value="(None)">(None)</option>
                    <option value="Detailed">Detailed</option>
                    <option value="High Quality">High Quality</option>
                    <option value="Ultra Detailed">Ultra Detailed</option>
                    <option value="Masterpiece">Masterpiece</option>
                  </select>
                </div>
              </div>

              <div class="switch-container">
                <label for="useUpscaler" class="form-label">Use Upscaler</label>
                <label class="switch">
                  <input type="checkbox" id="useUpscaler" checked>
                  <span class="slider-switch"></span>
                </label>
              </div>

              <div id="upscalerSettings">
                <div class="form-group">
                  <div class="form-header">
                    <label for="upscaleStrength" class="form-label">Upscale Strength</label>
                    <span class="form-value" id="upscaleStrengthValue">0.5</span>
                  </div>
                  <input type="range" id="upscaleStrength" class="slider" min="0" max="1" step="0.05" value="0.5">
                </div>

                <div class="form-group">
                  <div class="form-header">
                    <label for="upscaleBy" class="form-label">Upscale By</label>
                    <span class="form-value" id="upscaleByValue">1.2x</span>
                  </div>
                  <input type="range" id="upscaleBy" class="slider" min="1" max="1.5" step="0.05" value="1.2">
                </div>
              </div>

              <div class="switch-container">
                <label for="addQualityTags" class="form-label">Add Quality Tags</label>
                <label class="switch">
                  <input type="checkbox" id="addQualityTags" checked>
                  <span class="slider-switch"></span>
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="card-footer">
          <button id="generateBtn" class="btn btn-primary btn-block">
            <span class="btn-icon">🖼️</span> Generate Image
          </button>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Generated Image</h2>
          <p class="card-description">Your AI-generated masterpiece will appear here</p>
        </div>
        <div class="card-content">
          <div id="errorMessage" class="error-message" style="display: none;"></div>
          
          <div class="image-container" id="imageContainer">
            <div class="image-placeholder" id="imagePlaceholder">
              <div class="image-placeholder-icon">🖼️</div>
              <p class="image-placeholder-text">Enter a prompt and click Generate to create an image</p>
            </div>
          </div>
        </div>
        <div class="card-footer" id="downloadContainer" style="display: none;">
          <button id="downloadBtn" class="btn btn-outline btn-block">
            <span class="btn-icon">⬇️</span> Download Image
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const promptInput = document.getElementById('prompt');
    const negativePromptInput = document.getElementById('negativePrompt');
    const seedInput = document.getElementById('seed');
    const seedValue = document.getElementById('seedValue');
    const widthInput = document.getElementById('width');
    const widthValue = document.getElementById('widthValue');
    const heightInput = document.getElementById('height');
    const heightValue = document.getElementById('heightValue');
    const guidanceScaleInput = document.getElementById('guidanceScale');
    const guidanceScaleValue = document.getElementById('guidanceScaleValue');
    const stepsInput = document.getElementById('steps');
    const stepsValue = document.getElementById('stepsValue');
    const samplerSelect = document.getElementById('sampler');
    const aspectRatioInputs = document.querySelectorAll('input[name="aspectRatio"]');
    const stylePresetSelect = document.getElementById('stylePreset');
    const qualityPresetSelect = document.getElementById('qualityPreset');
    const useUpscalerInput = document.getElementById('useUpscaler');
    const upscalerSettings = document.getElementById('upscalerSettings');
    const upscaleStrengthInput = document.getElementById('upscaleStrength');
    const upscaleStrengthValue = document.getElementById('upscaleStrengthValue');
    const upscaleByInput = document.getElementById('upscaleBy');
    const upscaleByValue = document.getElementById('upscaleByValue');
    const addQualityTagsInput = document.getElementById('addQualityTags');
    const generateBtn = document.getElementById('generateBtn');
    const imageContainer = document.getElementById('imageContainer');
    const imagePlaceholder = document.getElementById('imagePlaceholder');
    const errorMessage = document.getElementById('errorMessage');
    const downloadContainer = document.getElementById('downloadContainer');
    const downloadBtn = document.getElementById('downloadBtn');
    const advancedSettingsHeader = document.getElementById('advancedSettingsHeader');
    const advancedSettingsContent = document.getElementById('advancedSettingsContent');

    let generatedImageUrl = null;
    let isGenerating = false;

    seedInput.addEventListener('input', () => {
      seedValue.textContent = seedInput.value;
    });

    widthInput.addEventListener('input', () => {
      widthValue.textContent = `${widthInput.value}px`;
    });

    heightInput.addEventListener('input', () => {
      heightValue.textContent = `${heightInput.value}px`;
    });

    guidanceScaleInput.addEventListener('input', () => {
      guidanceScaleValue.textContent = guidanceScaleInput.value;
    });

    stepsInput.addEventListener('input', () => {
      stepsValue.textContent = stepsInput.value;
    });

    upscaleStrengthInput.addEventListener('input', () => {
      upscaleStrengthValue.textContent = upscaleStrengthInput.value;
    });

    upscaleByInput.addEventListener('input', () => {
      upscaleByValue.textContent = `${upscaleByInput.value}x`;
    });

    useUpscalerInput.addEventListener('change', () => {
      upscalerSettings.style.display = useUpscalerInput.checked ? 'block' : 'none';
    });

    advancedSettingsHeader.addEventListener('click', () => {
      advancedSettingsContent.classList.toggle('active');
      advancedSettingsHeader.querySelector('.accordion-icon').textContent = 
        advancedSettingsContent.classList.contains('active') ? '▲' : '▼';
    });

    generateBtn.addEventListener('click', generateImage);
    downloadBtn.addEventListener('click', downloadImage);

    async function generateImage() {
      const prompt = promptInput.value.trim();
      if (!prompt) {
        showError('Please enter a prompt');
        return;
      }

      setGenerating(true);
      hideError();

      let selectedAspectRatio = '1024 x 1024';
      for (const radio of aspectRatioInputs) {
        if (radio.checked) {
          selectedAspectRatio = radio.value;
          break;
        }
      }

      try {
        const response = await fetch('/generate', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            prompt,
            negativePrompt: negativePromptInput.value,
            seed: parseInt(seedInput.value),
            width: parseInt(widthInput.value),
            height: parseInt(heightInput.value),
            guidanceScale: parseFloat(guidanceScaleInput.value),
            steps: parseInt(stepsInput.value),
            sampler: samplerSelect.value,
            aspectRatio: selectedAspectRatio,
            stylePreset: stylePresetSelect.value,
            qualityPreset: qualityPresetSelect.value,
            useUpscaler: useUpscalerInput.checked,
            upscaleStrength: parseFloat(upscaleStrengthInput.value),
            upscaleBy: parseFloat(upscaleByInput.value),
            addQualityTags: addQualityTagsInput.checked,
          }),
        });

        if (!response.ok) {
          throw new Error('Failed to generate image');
        }

        const data = await response.json();
        displayImage(data.imageUrl);
      } catch (error) {
        showError('Error generating image. Please try again.');
        console.error(error);
      } finally {
        setGenerating(false);
      }
    }

    function displayImage(imageUrl) {
      generatedImageUrl = imageUrl;
      
      imageContainer.innerHTML = '';
      
      const img = document.createElement('img');
      img.src = imageUrl;
      img.alt = 'Generated image';
      img.className = 'generated-image';
      imageContainer.appendChild(img);
      
      downloadContainer.style.display = 'block';
    }

    function downloadImage() {
      if (!generatedImageUrl) return;
      
      const link = document.createElement('a');
      link.href = generatedImageUrl;
      link.download = `generated-image-${Date.now()}.png`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function setGenerating(generating) {
      isGenerating = generating;
      generateBtn.disabled = generating;
      
      if (generating) {
        generateBtn.innerHTML = '<div class="spinner"></div> Generating...';
        
        imageContainer.innerHTML = `
          <div class="loading">
            <div class="spinner"></div>
            <p>Creating your image...</p>
          </div>
        `;
      } else {
        generateBtn.innerHTML = '<span class="btn-icon">🖼️</span> Generate Image';
      }
    }

    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
    }

    function hideError() {
      errorMessage.style.display = 'none';
    }

    upscalerSettings.style.display = useUpscalerInput.checked ? 'block' : 'none';
  </script>
</body>
</html>
